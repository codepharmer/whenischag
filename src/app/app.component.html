<!-- ════════════════════════════════════════════════════════════════ -->
<!-- SEARCH VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'search'">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1 class="app-title">When is chag ?</h1>
      <button class="settings-btn" (click)="goSettings()" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
          <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" />
          <path d="M19.4 15a1.7 1.7 0 0 0 .34 1.87l.06.06a2.1 2.1 0 0 1-1.49 3.58 2.1 2.1 0 0 1-1.49-.62l-.06-.06a1.7 1.7 0 0 0-1.87-.34 1.7 1.7 0 0 0-1.03 1.55V21a2.1 2.1 0 0 1-4.2 0v-.09a1.7 1.7 0 0 0-1.03-1.55 1.7 1.7 0 0 0-1.87.34l-.06.06a2.1 2.1 0 0 1-2.98 0 2.1 2.1 0 0 1 0-2.98l.06-.06A1.7 1.7 0 0 0 4.6 15a1.7 1.7 0 0 0-1.55-1.03H3a2.1 2.1 0 0 1 0-4.2h.09A1.7 1.7 0 0 0 4.64 8.8a1.7 1.7 0 0 0-.34-1.87l-.06-.06a2.1 2.1 0 0 1 0-2.98 2.1 2.1 0 0 1 2.98 0l.06.06a1.7 1.7 0 0 0 1.87.34 1.7 1.7 0 0 0 1.03-1.55V3a2.1 2.1 0 0 1 4.2 0v.09a1.7 1.7 0 0 0 1.03 1.55 1.7 1.7 0 0 0 1.87-.34l.06-.06a2.1 2.1 0 0 1 2.98 0 2.1 2.1 0 0 1 0 2.98l-.06.06a1.7 1.7 0 0 0-.34 1.87 1.7 1.7 0 0 0 1.55 1.03H21a2.1 2.1 0 0 1 0 4.2h-.09A1.7 1.7 0 0 0 19.4 15Z" />
        </svg>
      </button>
    </div>

    <div class="subtitle">{{ diaspora ? 'Diaspora' : 'Israel' }} calendar · Jewish &amp; US holidays</div>

    <!-- Search input -->
    <div class="search-area">
      <input
        #searchInput
        type="text"
        [(ngModel)]="query"
        (ngModelChange)="onQueryChange()"
        placeholder="Search holidays…"
        class="search-input"
        [class.active]="query"
        autofocus
      />

      <!-- Dropdown -->
      <div class="dropdown" *ngIf="query.trim().length > 0">
        <div class="dropdown-empty" *ngIf="filtered.length === 0">
          No holidays matching "{{ query }}"
        </div>

        <button
          *ngFor="let h of filtered; let i = index; let last = last"
          class="dropdown-row"
          [class.no-border]="last"
          (click)="goDetail(h)"
        >
          <div class="row-left">
            <div class="row-title-line">
              <span class="row-title">{{ h.title }}</span>
              <span class="now-badge-sm" *ngIf="isCurrent(h)">NOW</span>
            </div>
            <div class="row-meta">
              <span class="cat-badge-sm" [style.background]="getCatStyle(h.cat).bg" [style.color]="getCatStyle(h.cat).color">
                {{ getCatStyle(h.cat).label }}
              </span>
              <span class="meta-text" *ngIf="jewishSunsetShift(h.cat)">Starts {{ formatDateShort(h.nextStart) }} at sunset</span>
              <span class="meta-text" *ngIf="h.cat === 'fast'">Dawn to nightfall</span>
              <span class="meta-text" *ngIf="h.dayCount > 1">· {{ h.dayCount }} days</span>
            </div>
          </div>
          <div class="row-right">
            <app-week-strip
              class="row-weekstrip"
              [startDate]="h.nextDisplayStart"
              [endDate]="h.nextDisplayEnd"
              [cat]="h.cat"
            ></app-week-strip>

            <div class="row-right-text">
              <div class="row-date" [class.accent]="isAccentDate(h)">{{ formatDateShort(h.nextDisplayStart) }}</div>
              <div class="row-days" [class.accent]="isAccentDaysLabel(h)" [class.bold]="isBoldDaysLabel(h)">
                {{ daysLabel(h) }}
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="!query.trim()">
      <div class="empty-icon">✡︎</div>
      <p class="empty-text">Type a holiday name to look up its date.</p>
      <p class="empty-hint">Try "Rosh", "Passover", "Chanukah", or "Thanksgiving"</p>

      <div class="upcoming-section">
        <h3 class="section-label">Coming up</h3>
        <button
          *ngFor="let h of upcoming"
          class="upcoming-row"
          (click)="goDetail(h)"
        >
          <div class="upcoming-left">
            <span class="upcoming-title">{{ h.title }}</span>
            <span class="cat-badge-sm" [style.background]="getCatStyle(h.cat).bg" [style.color]="getCatStyle(h.cat).color">
              {{ getCatStyle(h.cat).label }}
            </span>
          </div>
          <div class="upcoming-right">
            <app-week-strip
              class="upcoming-weekstrip"
              [startDate]="h.nextDisplayStart"
              [endDate]="h.nextDisplayEnd"
              [cat]="h.cat"
            ></app-week-strip>
            <div class="upcoming-days">{{ upcomingLabel(h) }}</div>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- DETAIL VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'detail' && selected">
  <div class="container detail-container">
    <button class="back-btn" (click)="goSearch()">
      <span class="back-arrow">←</span> Back
    </button>

    <div class="detail-header">
      <h1 class="detail-title">{{ selected.title }}</h1>
      <p class="detail-hebrew" *ngIf="selected.hebrew">{{ selected.hebrew }}</p>
      <div class="detail-meta">
        <span class="cat-badge" [style.background]="getCatStyle(selected.cat).bg" [style.color]="getCatStyle(selected.cat).color">
          {{ getCatStyle(selected.cat).label }}
        </span>
        <span class="detail-desc" *ngIf="selected.desc">{{ selected.desc }}</span>
      </div>
    </div>

    <h2 class="section-label">Upcoming Dates</h2>

    <div
      *ngFor="let occ of selected.occurrences.slice(0, 8); let i = index"
      class="occ-card"
      [class.occ-current]="occIsCurrent(occ)"
      [class.occ-past]="occIsPast(occ)"
    >
      <div class="occ-top">
        <div class="occ-left">
          <div class="occ-date">{{ formatDate(occ.displayStart) }}</div>
          <div class="occ-through" *ngIf="occDisplayDays(occ) > 1">
            through {{ formatDate(occ.displayEnd) }} · {{ occDisplayDays(occ) }} days
          </div>
          <div class="occ-note" *ngIf="jewishSunsetShift(selected.cat)">Starts {{ formatDateShort(occ.start) }} at sunset</div>
          <div class="occ-note" *ngIf="selected.cat === 'fast'">Fast begins at dawn</div>
        </div>
        <div class="occ-right">
          <app-week-strip
            class="occ-weekstrip"
            [startDate]="occ.displayStart"
            [endDate]="occ.displayEnd"
            [cat]="selected.cat"
          ></app-week-strip>

          <div class="occ-right-text">
            <span class="now-badge" *ngIf="occIsCurrent(occ)">NOW</span>
            <span class="occ-countdown" *ngIf="!occIsCurrent(occ) && !occIsPast(occ)">{{ occDaysLabel(occ) }}</span>
          </div>
        </div>
      </div>
      <div class="occ-actions">
        <button class="action-btn" (click)="copyDate(getCopyText(occ, selected.title), '' + i)">
          {{ copiedId === '' + i ? 'Copied ✓' : 'Copy date' }}
        </button>
        <button
          class="action-btn"
          type="button"
          (click)="downloadIcs(selected.title, occ.start, occ.end)"
        >
          Add to Calendar
        </button>
      </div>
    </div>
  </div> 
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- SETTINGS VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'settings'">
  <div class="container">
    <button class="back-btn" (click)="goSearch()">
      <span class="back-arrow">←</span> Back
    </button>

    <h1 class="page-title">Settings</h1>

    <div class="settings-card">
      <div class="setting-row bordered">
        <div class="setting-info">
          <div class="setting-label">Calendar tradition</div>
          <div class="setting-sublabel">Affects Pesach, Shavuot, Sukkot duration</div>
        </div>
        <div class="toggle-group">
          <button class="toggle-btn" [class.active]="diaspora" (click)="setDiaspora(true)">Diaspora</button>
          <button class="toggle-btn" [class.active]="!diaspora" (click)="setDiaspora(false)">Israel</button>
        </div>
      </div>

      <button class="setting-row clickable" (click)="goAbout()">
        <div class="setting-info">
          <div class="setting-label">About</div>
          <div class="setting-sublabel">Data source &amp; privacy</div>
        </div>
        <span class="setting-arrow">→</span>
      </button>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- ABOUT VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'about'">
  <div class="container">
    <button class="back-btn" (click)="goSettings()">
      <span class="back-arrow">←</span> Settings
    </button>

    <h1 class="page-title">About</h1>

    <div class="about-card">
      <h3 class="about-heading">Data Source</h3>
      <p class="about-text">
        Jewish holiday dates calculated locally using the
        <a href="https://www.hebcal.com" target="_blank" rel="noopener noreferrer" class="about-link">Hebcal</a>
        calendar engine. US federal holidays computed algorithmically.
      </p>
      <h3 class="about-heading">Privacy</h3>
      <p class="about-text last">
        No data collection. No cookies. No analytics. No tracking. Your searches stay in your browser.
      </p>
    </div>
  </div>
</div>
