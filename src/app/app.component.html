<!-- ════════════════════════════════════════════════════════════════ -->
<!-- SEARCH VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'search'">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1 class="app-title">When is it?</h1>
      <button class="settings-btn" (click)="goSettings()" title="Settings">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="10" cy="10" r="2.5"/><path d="M10 1.5v2M10 16.5v2M1.5 10h2M16.5 10h2M3.4 3.4l1.4 1.4M15.2 15.2l1.4 1.4M3.4 16.6l1.4-1.4M15.2 4.8l1.4-1.4"/>
        </svg>
      </button>
    </div>

    <div class="subtitle">{{ diaspora ? 'Diaspora' : 'Israel' }} calendar · Jewish &amp; US holidays</div>

    <!-- Search input -->
    <div class="search-area">
      <input
        #searchInput
        type="text"
        [(ngModel)]="query"
        (ngModelChange)="onQueryChange()"
        placeholder="Search holidays…"
        class="search-input"
        [class.active]="query"
        autofocus
      />

      <!-- Dropdown -->
      <div class="dropdown" *ngIf="query.trim().length > 0">
        <div class="dropdown-empty" *ngIf="filtered.length === 0">
          No holidays matching "{{ query }}"
        </div>

        <button
          *ngFor="let h of filtered; let i = index; let last = last"
          class="dropdown-row"
          [class.no-border]="last"
          (click)="goDetail(h)"
        >
          <div class="row-left">
            <div class="row-title-line">
              <span class="row-title">{{ h.title }}</span>
              <span class="now-badge-sm" *ngIf="isCurrent(h)">NOW</span>
            </div>
            <div class="row-meta">
              <span class="cat-badge-sm" [style.background]="getCatStyle(h.cat).bg" [style.color]="getCatStyle(h.cat).color">
                {{ getCatStyle(h.cat).label }}
              </span>
              <span class="meta-text" *ngIf="jewishSunsetShift(h.cat)">Starts evening before at sunset</span>
              <span class="meta-text" *ngIf="h.cat === 'fast'">Dawn to nightfall</span>
              <span class="meta-text" *ngIf="h.dayCount > 1">· {{ h.dayCount }} days</span>
            </div>
          </div>
          <div class="row-right">
            <div class="row-date" [class.accent]="isAccentDate(h)">{{ formatDateShort(h.nextDisplayStart) }}</div>
            <div class="row-days" [class.accent]="isAccentDaysLabel(h)" [class.bold]="isBoldDaysLabel(h)">
              {{ daysLabel(h) }}
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="!query.trim()">
      <div class="empty-icon">✡︎</div>
      <p class="empty-text">Type a holiday name to look up its date.</p>
      <p class="empty-hint">Try "Rosh", "Passover", "Chanukah", or "Thanksgiving"</p>

      <div class="upcoming-section">
        <h3 class="section-label">Coming up</h3>
        <button
          *ngFor="let h of upcoming"
          class="upcoming-row"
          (click)="goDetail(h)"
        >
          <div class="upcoming-left">
            <span class="upcoming-title">{{ h.title }}</span>
            <span class="cat-badge-sm" [style.background]="getCatStyle(h.cat).bg" [style.color]="getCatStyle(h.cat).color">
              {{ getCatStyle(h.cat).label }}
            </span>
          </div>
          <div class="upcoming-days">{{ upcomingLabel(h) }}</div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- DETAIL VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'detail' && selected">
  <div class="container detail-container">
    <button class="back-btn" (click)="goSearch()">
      <span class="back-arrow">←</span> Back
    </button>

    <div class="detail-header">
      <h1 class="detail-title">{{ selected.title }}</h1>
      <p class="detail-hebrew" *ngIf="selected.hebrew">{{ selected.hebrew }}</p>
      <div class="detail-meta">
        <span class="cat-badge" [style.background]="getCatStyle(selected.cat).bg" [style.color]="getCatStyle(selected.cat).color">
          {{ getCatStyle(selected.cat).label }}
        </span>
        <span class="detail-desc" *ngIf="selected.desc">{{ selected.desc }}</span>
      </div>
    </div>

    <h2 class="section-label">Upcoming Dates</h2>

    <div
      *ngFor="let occ of selected.occurrences.slice(0, 8); let i = index"
      class="occ-card"
      [class.occ-current]="occIsCurrent(occ)"
      [class.occ-past]="occIsPast(occ)"
    >
      <div class="occ-top">
        <div class="occ-left">
          <div class="occ-date">{{ formatDate(occ.displayStart) }}</div>
          <div class="occ-through" *ngIf="occDisplayDays(occ) > 1">
            through {{ formatDate(occ.displayEnd) }} · {{ occDisplayDays(occ) }} days
          </div>
          <div class="occ-note" *ngIf="jewishSunsetShift(selected.cat)">Starts the evening before at sunset</div>
          <div class="occ-note" *ngIf="selected.cat === 'fast'">Fast begins at dawn</div>
        </div>
        <div class="occ-right">
          <span class="now-badge" *ngIf="occIsCurrent(occ)">NOW</span>
          <span class="occ-countdown" *ngIf="!occIsCurrent(occ) && !occIsPast(occ)">{{ occDaysLabel(occ) }}</span>
        </div>
      </div>
      <div class="occ-actions">
        <button class="action-btn" (click)="copyDate(getCopyText(occ, selected.title), '' + i)">
          {{ copiedId === '' + i ? 'Copied ✓' : 'Copy date' }}
        </button>
        <a class="action-btn" [href]="gcalUrl(selected.title, occ.start, occ.end)" target="_blank" rel="noopener noreferrer">
          Add to Calendar
        </a>
      </div>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- SETTINGS VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'settings'">
  <div class="container">
    <button class="back-btn" (click)="goSearch()">
      <span class="back-arrow">←</span> Back
    </button>

    <h1 class="page-title">Settings</h1>

    <div class="settings-card">
      <div class="setting-row bordered">
        <div class="setting-info">
          <div class="setting-label">Calendar tradition</div>
          <div class="setting-sublabel">Affects Pesach, Shavuot, Shmini Atzeret duration</div>
        </div>
        <div class="toggle-group">
          <button class="toggle-btn" [class.active]="diaspora" (click)="setDiaspora(true)">Diaspora</button>
          <button class="toggle-btn" [class.active]="!diaspora" (click)="setDiaspora(false)">Israel</button>
        </div>
      </div>

      <button class="setting-row clickable" (click)="goAbout()">
        <div class="setting-info">
          <div class="setting-label">About</div>
          <div class="setting-sublabel">Data source &amp; privacy</div>
        </div>
        <span class="setting-arrow">→</span>
      </button>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════════════════════════ -->
<!-- ABOUT VIEW -->
<!-- ════════════════════════════════════════════════════════════════ -->
<div class="app" *ngIf="view === 'about'">
  <div class="container">
    <button class="back-btn" (click)="goSettings()">
      <span class="back-arrow">←</span> Settings
    </button>

    <h1 class="page-title">About</h1>

    <div class="about-card">
      <h3 class="about-heading">Data Source</h3>
      <p class="about-text">
        Jewish holiday dates sourced from
        <a href="https://www.hebcal.com" target="_blank" rel="noopener noreferrer" class="about-link">Hebcal</a>,
        a trusted open-source Jewish calendar engine (CC BY 4.0). US federal holidays computed algorithmically. Coverage: 2025–2030.
      </p>
      <h3 class="about-heading">Privacy</h3>
      <p class="about-text last">
        No data collection. No cookies. No analytics. No tracking. Your searches stay in your browser.
      </p>
    </div>
  </div>
</div>
